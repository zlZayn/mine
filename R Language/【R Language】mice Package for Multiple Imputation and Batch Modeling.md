![mice r package logo](https://pica.zhimg.com/v2-517d187895cdc2734f566b6918daa350_1440w.jpg)

```R
> packageVersion("mice") # mice package version used in this article
[1] ‘3.18.0’
```

![MICE Method Schematic](https://pic2.zhimg.com/v2-6c24556374d7eae28580a9663eec1de9_1440w.jpg)

The `mice` package (Multivariate Imputation by Chained Equations) is a tool package in R for handling missing values. Its core function is to generate multiple complete datasets (rather than a single imputation result) through the **chained equations multiple imputation method**. Compared to simple imputation (such as mean imputation), it better preserves data distribution and variable relationships, making it particularly suitable for complex missing patterns.

**Types of special R objects:**

| Special R Object Type | Full Name | Source | Function |
| --------------------- | --------- | ------ | -------- |
| mids | Multiply Imputed Data Set | Generated by mice() | Stores multiple imputed datasets |
| mira | Multiply Imputed Repeated Analyses | Analysis of mids with with() | Stores separate analysis results for each dataset |
| mipo | Multiply Imputed Pooled Results | Merging mira with pool() | Merges to get final statistics |

The `mice` package mainly has the following functions:

1.  **Build prediction models for variables with missing values**
2.  **Generate multiple imputed datasets**
3.  **Subsequent batch modeling and integration of results**

* * *

**Multiple imputation of missing data** → **Batch modeling on multiple datasets** → **Merge model results**

```R
library(tidyverse)
library(mice)
```

## 1. Data and Missing Value Viewing

```R
data(airquality)
# Built-in air quality dataset

airquality |> glimpse()
# Preview the data structure of airquality

airquality |> map_int(\(c) sum(is.na(c)))
# Check missing values in each column

md.pattern(airquality)
# Count and visualize missing value patterns
```

![](https://pic4.zhimg.com/v2-d4c3a10c3f51c4b8d8b55eca660d5cf3_1440w.jpg)![](https://pic2.zhimg.com/v2-cd9463c43dd9608965d97f00d3b18af3_1440w.jpg)![md.pattern()](https://pic3.zhimg.com/v2-3010c7bab286c18304673298561bba60_1440w.jpg)| md.pattern() Result Description | Interpretation |
| ------------------------------- | -------------- |
| Number on the far left of each row | Total frequency of this pattern |
| Middle 1 (blue) and 0 (red) | Indicate whether each column (variable) in each row (observation) has missing values under this pattern |
| Number on the far right of each row | Total number of missing values per row (observation) under this pattern |
| Number at the bottom of each column | Total number of missing values per column (variable) |

## 2. mice() Multiple Imputation

```R
set.seed(123)

mids <- airquality |>
  mice(m = 5, method = "pmm")
# Predictive mean matching, 5 multiple imputations

stripplot(mids, chl)
# Draw strip plot of original data and 5 imputed data with missing value markers
```

![Red indicates imputation markers](https://pic1.zhimg.com/v2-813b746bb0dec29a591f74a791bb9892_1440w.jpg)

## 3. complete() Extract Imputed data.frame

```R
imputed_data_3 <- mids |>
  complete(3)
# Extract only the third data.frame

imputed_data_3 |> map_int(\(c) sum(is.na(c)))
# Verify missing values in each column
```

![](https://pica.zhimg.com/v2-3bbc3caedc6742972d9cf6253ab105d6_1440w.jpg)![](https://pic1.zhimg.com/v2-dc404ea28cad69257a0b733383711244_1440w.jpg)

You can also extract all complete imputed datasets at once in the following five ways:

```R
walk2(
  c("ALL", "STACKED", "LONG", "BROAD", "REPEATED"),
  c("all", "stacked", "long", "broad", "repeated"),
  \(name, arg) assign(name, complete(mids, action = arg), envir = .GlobalEnv)
  )
# Will generate these 5 objects with different imputation result formats in the global environment
```

| action = parameter | Object Type | Features |
| ------------------ | ----------- | -------- |
| "all" | List | Each element is a complete imputed dataset |
| "stacked" | Long format data frame | |
| "long" | Long format data frame | Additional .imp (imputation set) and .id (row index) markers |
| "broad" | Wide format data frame | |
| "repeated" | Wide format data frame | Repeated wide format |

## 4. with() Batch Modeling

```R
mira <- mids |>
  with(lm(Ozone ~ Solar.R + Wind + Temp + Month + Day))
# Batch fit the same linear regression model

mira_analysis <- mira |> summary()
# Can get summary results of 5 models
```

![](https://pica.zhimg.com/v2-b34a628e5603e647475011aae1874680_1440w.jpg)

## 5. pool() Merge Analysis Results

```R
mipo <- mira |>
  pool()
# Based on statistical theory, one-click merge analysis to get final results

mipo_analysis <- mipo |> summary()
# Get final summary results of the merged model
```

![](https://pic3.zhimg.com/v2-30b7a61ab4fbabb96e079bd0ad82e9ca_1440w.jpg)

From the table, we can get the **final linear regression equation**

$$Ozone = -66.096 + 0.048 Solar.R - 3.012 Wind + 1.859 Temp - 2.875 Month + 0.304 Day$$



Types of **R objects** in this article

![R objects' types](https://pic3.zhimg.com/v2-8d0cf23c32bf2ddd654640f9723ff392_1440w.jpg)![MICE Method Schematic](https://pic2.zhimg.com/v2-6c24556374d7eae28580a9663eec1de9_1440w.jpg)

* * *

Appendix:

Built-in univariate imputation methods in the `mice` package

| Imputation Method Name | Applicable Data Type | Method Full Name / Description |
| ---------------------- | -------------------- | ------------------------------- |
| pmm | any | Predictive mean matching |
| midastouch | any | Weighted predictive mean matching |
| sample | any | Random sample from observed values |
| cart | any | Classification and regression trees |
| rf | any | Random forest imputations |
| mean | numeric | Unconditional mean imputation |
| norm | numeric | Bayesian linear regression |
| norm.nob | numeric | Linear regression ignoring model error |
| norm.boot | numeric | Linear regression using bootstrap |
| norm.predict | numeric | Linear regression, predicted values |
| lasso.norm | numeric | Lasso linear regression |
| lasso.select.norm | numeric | Lasso select + linear regression |
| quadratic | numeric | Imputation of quadratic terms |
| ri | numeric | Random indicator for nonignorable data |
| logreg | binary | Logistic regression |
| logreg.boot | binary | Logistic regression with bootstrap |
| lasso.logreg | binary | Lasso logistic regression |
| lasso.select.logreg | binary | Lasso select + logistic regression |
| polr | ordered | Proportional odds model |
| polyreg | unordered | Polytomous logistic regression |
| lda | unordered | Linear discriminant analysis |
| 2l.norm | numeric | Level - 1 normal heteroscedastic |
| 2l.lmer | numeric | Level - 1 normal homoscedastic, lmer |
| 2l.pan | numeric | Level - 1 normal homoscedastic, pan |
| 2l.bin | binary | Level - 1 logistic, glmer |
| 2lonly.mean | numeric | Level - 2 class mean |
| 2lonly.norm | numeric | Level - 2 class normal |
| 2lonly.pmm | any | Level - 2 class predictive mean matching |

* * *

References:

[mice](https://link.zhihu.com/?target=https%3A//amices.org/mice/)[处理缺失值之多重插补（Multiple Imputation）](https://zhuanlan.zhihu.com/p/36436260)[缺失值的高级处理：用mice进行多重填补](https://link.zhihu.com/?target=https%3A//cloud.tencent.com/developer/article/1972392)[R语言缺失值判断与处理mice包-3_r mice-CSDN博客](https://link.zhihu.com/?target=https%3A//blog.csdn.net/LeaningR/article/details/120145073)